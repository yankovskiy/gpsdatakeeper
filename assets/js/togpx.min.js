(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define([],b)}else{var a;if(typeof window!=="undefined"){a=window}else{if(typeof global!=="undefined"){a=global}else{if(typeof self!=="undefined"){a=self}else{a=this}}}a.togpx=b()}}})(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var r=f[q][1][l];return g(r?r:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(g,h,f){var e=g("jxon");e.config({attrPrefix:"@"});function i(k,t){t=(function(w,v){for(var u in w){if(v.hasOwnProperty(u)){w[u]=v[u]}}return w})({creator:"togpx",metadata:undefined,featureTitle:s,featureDescription:j,featureLink:undefined,featureCoordTimes:r},t||{});if(typeof t.featureCoordTimes==="string"){var p=t.featureCoordTimes;t.featureCoordTimes=function(u){return u.properties[p]}}function s(v){if(!v){return""}if(typeof v.tags==="object"){var u=s(v.tags);if(u!==""){return u}}if(v.name){return v.name}if(v.ref){return v.ref}if(v.id){return v.id}return""}function j(w){if(!w){return""}if(typeof w.tags==="object"){return j(w.tags)}var v="";for(var u in w){if(typeof w[u]==="object"){continue}v+=u+"="+w[u]+"\n"}return v.substr(0,v.length-1)}function r(u){if(!u.properties){return null}return u.properties.times||u.properties.coordTimes||null}function q(v,u){if(t.featureLink){v.link={"@href":t.featureLink(u.properties)}}}var m={gpx:{"@xmlns":"http://www.topografix.com/GPX/1/1","@xmlns:xsi":"http://www.w3.org/2001/XMLSchema-instance","@xsi:schemaLocation":"http://www.topografix.com/GPX/1/1 http://www.topografix.com/GPX/1/1/gpx.xsd","@version":"1.1",metadata:null,wpt:[],trk:[]}};if(t.creator){m.gpx["@creator"]=t.creator}if(t.metadata){m.gpx.metadata=t.metadata}else{delete t.metadata}var l;if(k.type==="FeatureCollection"){l=k.features}else{if(k.type==="Feature"){l=[k]}else{l=[{type:"Feature",properties:{},geometry:k}]}}l.forEach(function n(v){switch(v.geometry.type){case"Point":case"MultiPoint":var u=v.geometry.coordinates;if(v.geometry.type=="Point"){u=[u]}u.forEach(function(x){o={"@lat":x[1],"@lon":x[0],name:t.featureTitle(v.properties),desc:t.featureDescription(v.properties)};if(x[2]!==undefined){o.ele=x[2]}q(o,v);m.gpx.wpt.push(o)});break;case"LineString":case"MultiLineString":var u=v.geometry.coordinates;var w=t.featureCoordTimes(v);if(v.geometry.type=="LineString"){u=[u]}o={name:t.featureTitle(v.properties),desc:t.featureDescription(v.properties)};q(o,v);o.trkseg=[];u.forEach(function(y){var x={trkpt:[]};y.forEach(function(B,z){var A={"@lat":B[1],"@lon":B[0]};if(B[2]!==undefined){A.ele=B[2]}if(w&&w[z]){A.time=w[z]}x.trkpt.push(A)});o.trkseg.push(x)});m.gpx.trk.push(o);break;case"Polygon":case"MultiPolygon":o={name:t.featureTitle(v.properties),desc:t.featureDescription(v.properties)};q(o,v);o.trkseg=[];var u=v.geometry.coordinates;var w=t.featureCoordTimes(v);if(v.geometry.type=="Polygon"){u=[u]}u.forEach(function(x){x.forEach(function(z){var y={trkpt:[]};var A=0;z.forEach(function(C){var B={"@lat":C[1],"@lon":C[0]};if(C[2]!==undefined){B.ele=C[2]}if(w&&w[A]){B.time=w[A]}A++;y.trkpt.push(B)});o.trkseg.push(y)})});m.gpx.trk.push(o);break;case"GeometryCollection":v.geometry.geometries.forEach(function(y){var x={properties:v.properties,geometry:y};n(x)});break;default:console.log("warning: unsupported geometry type: "+v.geometry.type)}});gpx_str=e.stringify(m);return gpx_str}h.exports=i},{jxon:2}],2:[function(f,g,e){(function(h,i){if(typeof d==="function"&&d.amd){d([],i(window))}else{if(typeof e==="object"){if(typeof window==="object"&&window.DOMImplementation&&window.XMLSerializer&&window.DOMParser){g.exports=i(window)}else{g.exports=i(f("xmldom"),true)}}else{h.JXON=i(window)}}}(this,function(n,i){var m={valueKey:"_",attrKey:"$",attrPrefix:"$",lowerCaseTags:false,trueIsEmpty:false,autoDate:false,ignorePrefixedNodes:false,parseValues:false};var h=[];var k=/^\s*$/;var j=/^(?:true|false)$/i;var l;return new (function(){this.config=function(u){for(var v in u){m[v]=u[v]}if(m.parserErrorHandler){l=new n.DOMParser({errorHandler:m.parserErrorHandler,locator:{}})}};function s(u){if(!m.parseValues){return u}if(k.test(u)){return null}if(j.test(u)){return u.toLowerCase()==="true"}if(isFinite(u)){return parseFloat(u)}if(m.autoDate&&isFinite(Date.parse(u))){return new Date(u)}return u}function p(){}p.prototype.toString=function(){return"null"};p.prototype.valueOf=function(){return null};function t(u){return u===null?new p():u instanceof Object?u:new u.constructor(u)}function r(u,y,M,v){var H=4,R=3,K=1,S=h.length,A=u.hasChildNodes(),L=u.nodeType===u.ELEMENT_NODE&&u.hasAttributes(),U=Boolean(y&2),E=0,B="",Q=U?{}:(m.trueIsEmpty?true:""),z,O;if(A){for(var D,T=0;T<u.childNodes.length;T++){D=u.childNodes.item(T);if(D.nodeType===H){B+=D.nodeValue}else{if(D.nodeType===R){B+=D.nodeValue.trim()}else{if(D.nodeType===K&&!(m.ignorePrefixedNodes&&D.prefix)){h.push(D)}}}}}var x=h.length,J=s(B);if(!U&&(A||L)){Q=y===0?t(J):{}}for(var F=S;F<x;F++){z=h[F].nodeName;if(m.lowerCaseTags){z=z.toLowerCase()}O=r(h[F],y,M,v);if(Q.hasOwnProperty(z)){if(Q[z].constructor!==Array){Q[z]=[Q[z]]}Q[z].push(O)}else{Q[z]=O;E++}}if(L){var G=u.attributes.length,C=v?"":m.attrPrefix,w=v?{}:Q;for(var I,P,N=0;N<G;E++,N++){I=u.attributes.item(N);P=I.name;if(m.lowerCaseTags){P=P.toLowerCase()}w[C+P]=s(I.value.trim())}if(v){if(M){Object.freeze(w)}Q[m.attrKey]=w;E-=G-1}}if(y===3||(y===2||y===1&&E>0)&&B){Q[m.valueKey]=J}else{if(!U&&E===0&&B){Q=J}}if(M&&(U||E>0)){Object.freeze(Q)}h.length=S;return Q}function q(y,v,u){var A,C,x;if(u.constructor===String||u.constructor===Number||u.constructor===Boolean){v.appendChild(y.createTextNode(u.toString()));if(u===u.valueOf()){return}}else{if(u.constructor===Date){v.appendChild(y.createTextNode(u.toISOString()))}}for(var w in u){A=u[w];if(A===undefined){continue}if(A===null){A={}}if(isFinite(w)||A instanceof Function){continue}if(w===m.valueKey){if(A!==null&&A!==true){v.appendChild(y.createTextNode(A.constructor===Date?A.toISOString():String(A)))}}else{if(w===m.attrKey){for(var B in A){v.setAttribute(B,A[B])}}else{if(w===m.attrPrefix+"xmlns"){if(i){v.setAttribute(w.slice(1),A)}}else{if(w.charAt(0)===m.attrPrefix){v.setAttribute(w.slice(1),A)}else{if(A.constructor===Array){for(var z in A){if(!A.hasOwnProperty(z)){continue}x=(A[z]&&A[z][m.attrPrefix+"xmlns"])||v.namespaceURI;if(x){C=y.createElementNS(x,w)}else{C=y.createElement(w)}q(y,C,A[z]||{});v.appendChild(C)}}else{x=(A||{})[m.attrPrefix+"xmlns"]||v.namespaceURI;if(x){C=y.createElementNS(x,w)}else{C=y.createElement(w)}if(A instanceof Object){q(y,C,A)}else{if(A!==null&&(A!==true||!m.trueIsEmpty)){C.appendChild(y.createTextNode(A.toString()))}}v.appendChild(C)}}}}}}}this.xmlToJs=this.build=function(y,x,w,v){var u=arguments.length>1&&typeof x==="number"?x&3:1;return r(y,u,w||false,arguments.length>3?v:u===3)};this.jsToXml=this.unbuild=function(w,y,v,z){var u=n.document&&n.document.implementation||new n.DOMImplementation();var x=u.createDocument(y||null,v||"",z||null);q(x,x.documentElement||x,w);return x};this.stringToXml=function(u){if(!l){l=new n.DOMParser()}return l.parseFromString(u,"application/xml")};this.xmlToString=function(u){if(typeof u.xml!=="undefined"){return u.xml}else{return(new n.XMLSerializer()).serializeToString(u)}};this.stringToJs=function(v){var u=this.stringToXml(v);return this.xmlToJs(u)};this.jsToString=this.stringify=function(v,w,u,x){return this.xmlToString(this.jsToXml(v,w,u,x))};this.each=function(u,w,v){if(u instanceof Array){u.forEach(w,v)}else{[u].forEach(w,v)}}})()}))},{xmldom:3}],3:[function(f,g,e){},{}]},{},[1])(1)});