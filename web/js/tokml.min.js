(function(b){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=b()}else{if(typeof define==="function"&&define.amd){define([],b)}else{var a;if(typeof window!=="undefined"){a=window}else{if(typeof global!=="undefined"){a=global}else{if(typeof self!=="undefined"){a=self}else{a=this}}}a.tokml=b()}}})(function(){var d,b,a;return(function c(f,k,h){function g(q,n){if(!k[q]){if(!f[q]){var m=typeof require=="function"&&require;if(!n&&m){return m(q,!0)}if(e){return e(q,!0)}var p=new Error("Cannot find module '"+q+"'");throw p.code="MODULE_NOT_FOUND",p}var i=k[q]={exports:{}};f[q][0].call(i.exports,function(l){var o=f[q][1][l];return g(o?o:l)},i,i.exports,c,f,k,h)}return k[q].exports}var e=typeof require=="function"&&require;for(var j=0;j<h.length;j++){g(h[j])}return g})({1:[function(o,e,B){var z=o("strxml"),D=z.tag,k=z.encode;e.exports=function f(G,F){F=F||{documentName:undefined,documentDescription:undefined,name:"name",description:"description",simplestyle:false,timestamp:"timestamp"};return'<?xml version="1.0" encoding="UTF-8"?>'+D("kml",D("Document",p(F)+h(F)+u(G,F)),[["xmlns","http://www.opengis.net/kml/2.2"]])};function l(F,G){return function(H){if(!H.properties||!j.valid(H.geometry)){return""}var K=j.any(H.geometry);if(!K){return""}var I="",J="";if(F.simplestyle){var L=w(H.properties);if(L){if(j.isPoint(H.geometry)&&r(H.properties)){if(G.indexOf(L)===-1){I=y(H.properties,L);G.push(L)}J=D("styleUrl","#"+L)}else{if((j.isPolygon(H.geometry)||j.isLine(H.geometry))&&t(H.properties)){if(G.indexOf(L)===-1){I=m(H.properties,L);G.push(L)}J=D("styleUrl","#"+L)}}}}return I+D("Placemark",E(H.properties,F)+v(H.properties,F)+n(H.properties)+g(H.properties,F)+K+J)}}function u(G,F){if(!G.type){return""}var H=[];switch(G.type){case"FeatureCollection":if(!G.features){return""}return G.features.map(l(F,H)).join("");case"Feature":return l(F,H)(G);default:return l(F,H)({type:"Feature",geometry:G,properties:{}})}}function p(F){return(F.documentName!==undefined)?D("name",F.documentName):""}function h(F){return(F.documentDescription!==undefined)?D("description",F.documentDescription):""}function E(G,F){return G[F.name]?D("name",k(G[F.name])):""}function v(G,F){return G[F.description]?D("description",k(G[F.description])):""}function g(G,F){return G[F.timestamp]?D("TimeStamp",D("when",k(G[F.timestamp]))):""}var j={Point:function(F){return D("Point",D("coordinates",F.coordinates.join(",")))},LineString:function(F){return D("LineString",D("coordinates",q(F.coordinates)))},Polygon:function(I){if(!I.coordinates.length){return""}var J=I.coordinates[0],G=I.coordinates.slice(1),F=D("outerBoundaryIs",D("LinearRing",D("coordinates",q(J)))),H=G.map(function(K){return D("innerBoundaryIs",D("LinearRing",D("coordinates",q(K))))}).join("");return D("Polygon",F+H)},MultiPoint:function(F){if(!F.coordinates.length){return""}return D("MultiGeometry",F.coordinates.map(function(G){return j.Point({coordinates:G})}).join(""))},MultiPolygon:function(F){if(!F.coordinates.length){return""}return D("MultiGeometry",F.coordinates.map(function(G){return j.Polygon({coordinates:G})}).join(""))},MultiLineString:function(F){if(!F.coordinates.length){return""}return D("MultiGeometry",F.coordinates.map(function(G){return j.LineString({coordinates:G})}).join(""))},GeometryCollection:function(F){return D("MultiGeometry",F.geometries.map(j.any).join(""))},valid:function(F){return F&&F.type&&(F.coordinates||F.type==="GeometryCollection"&&F.geometries&&F.geometries.every(j.valid))},any:function(F){if(j[F.type]){return j[F.type](F)}else{return""}},isPoint:function(F){return F.type==="Point"||F.type==="MultiPoint"},isPolygon:function(F){return F.type==="Polygon"||F.type==="MultiPolygon"},isLine:function(F){return F.type==="LineString"||F.type==="MultiLineString"}};function q(F){return F.map(function(G){return G.join(",")}).join(" ")}function n(F){return D("ExtendedData",C(F).map(A).join(""))}function A(F){return D("Data",D("value",k(F[1])),[["name",k(F[0])]])}function r(F){return !!(F["marker-size"]||F["marker-symbol"]||F["marker-color"])}function y(F,G){return D("Style",D("IconStyle",D("Icon",D("href",i(F))))+x(F),[["id",G]])}function i(G){var H=G["marker-size"]||"medium",I=G["marker-symbol"]?"-"+G["marker-symbol"]:"",F=(G["marker-color"]||"7e7e7e").replace("#","");return"https://api.tiles.mapbox.com/v3/marker/pin-"+H.charAt(0)+I+"+"+F+".png"}function x(F){return D("hotSpot","",[["xunits","fraction"],["yunits","fraction"],["x",0.5],["y",0.5]])}function t(F){for(var G in F){if({stroke:true,"stroke-opacity":true,"stroke-width":true,fill:true,"fill-opacity":true}[G]){return true}}}function m(H,I){var F=D("LineStyle",[D("color",s(H.stroke,H["stroke-opacity"])||"ff555555")+D("width",H["stroke-width"]===undefined?2:H["stroke-width"])]);var G="";if(H.fill||H["fill-opacity"]){G=D("PolyStyle",[D("color",s(H.fill,H["fill-opacity"])||"88555555")])}return D("Style",F+G,[["id",I]])}function w(F){var G="";if(F["marker-symbol"]){G=G+"ms"+F["marker-symbol"]}if(F["marker-color"]){G=G+"mc"+F["marker-color"].replace("#","")}if(F["marker-size"]){G=G+"ms"+F["marker-size"]}if(F.stroke){G=G+"s"+F.stroke.replace("#","")}if(F["stroke-width"]){G=G+"sw"+F["stroke-width"].toString().replace(".","")}if(F["stroke-opacity"]){G=G+"mo"+F["stroke-opacity"].toString().replace(".","")}if(F.fill){G=G+"f"+F.fill.replace("#","")}if(F["fill-opacity"]){G=G+"fo"+F["fill-opacity"].toString().replace(".","")}return G}function s(H,G){if(typeof H!=="string"){return""}H=H.replace("#","").toLowerCase();if(H.length===3){H=H[0]+H[0]+H[1]+H[1]+H[2]+H[2]}else{if(H.length!==6){return""}}var J=H[0]+H[1];var I=H[2]+H[3];var F=H[4]+H[5];var K="ff";if(typeof G==="number"&&G>=0&&G<=1){K=(G*255).toString(16);if(K.indexOf(".")>-1){K=K.substr(0,K.indexOf("."))}if(K.length<2){K="0"+K}}return K+F+I+J}function C(F){var H=[];for(var G in F){H.push([G,F[G]])}return H}},{strxml:2}],2:[function(i,j,h){j.exports.attr=f;j.exports.tagClose=g;j.exports.tag=e;j.exports.encode=k;function f(l){return(l&&l.length)?(" "+l.map(function(m){return m[0]+'="'+m[1]+'"'}).join(" ")):""}function g(m,l){return"<"+m+f(l)+"/>"}function e(m,n,l){return"<"+m+f(l)+">"+n+"</"+m+">"}function k(l){return(l===null?"":l.toString()).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}},{}]},{},[1])(1)});